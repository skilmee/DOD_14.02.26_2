from flask import Flask, render_template, request, redirect, url_for, session, flash
import random

app = Flask(__name__)
app.secret_key = "change-this-secret-key"

# =========================================================
# –î–µ–Ω—å –≤—Å–µ—Ö –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö ‚ù§Ô∏è
# –°—é–∂–µ—Ç:
# –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ø—Ä–∏–¥—É–º–∞–ª –∏—Å–ø—ã—Ç–∞–Ω–∏—è –¥–ª—è –ë—Ä–æ–¥—è–≥–∏.
# –ü—Ä–æ–π–¥—ë—à—å –∏—Ö ‚Äî –ø–æ–º–æ–∂–µ—à—å –ë—Ä–æ–¥—è–≥–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å —Å–≤–æ—é –≤—Ç–æ—Ä—É—é –ø–æ–ª–æ–≤–∏–Ω–∫—É üíò
# =========================================================

# =========================================================
# –ò–≥—Ä–∞ 1: –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (—Ä–µ–∂–∏–º quiz)
# –í–û–ü–†–û–°–´/–û–¢–í–ï–¢–´/–ü–û–Ø–°–ù–ï–ù–ò–Ø ‚Äî –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (–ù–ï –ú–ï–ù–Ø–ï–ú).
# –ú–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ "–æ–±—ë—Ä—Ç–∫—É" (explain) –ø–æ–¥ 14 —Ñ–µ–≤—Ä–∞–ª—è –∏ —Å—é–∂–µ—Ç —Å –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç–æ–º –∏ –ë—Ä–æ–¥—è–≥–æ–π.
# =========================================================

QUIZ_TASKS = [
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –≥–æ—Ç–æ–≤–∏—Ç –ë—Ä–æ–¥—è–≥—É –∫ –≤—Å—Ç—Ä–µ—á–µ –≤ –î–µ–Ω—å –≤—Å–µ—Ö –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö üíò. "
            "–ü–µ—Ä–≤–æ–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ: ¬´—É–º–Ω–∞—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞¬ª –ø–æ–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ —à–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è ‚Äî "
            "–∫–∞–∂–¥—É—é –±—É–∫–≤—É —Å–¥–≤–∏–≥–∞—é—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. "
            "–ß–∏—Å–ª–æ —à–∞–≥–æ–≤ ‚Äî —ç—Ç–æ –∫–ª—é—á."
        ),
        "vraag": (
            "–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–æ–≤–æ ¬´–º–Ω–∞—ç¬ª, –∞ –∫–æ—Ç –ø–æ–º–Ω–∏—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–¥–≤–∏–≥ ‚àí2.\n"
            "–ö–∞–∫–æ–µ —Å–ª–æ–≤–æ —Å–∫—Ä—ã—Ç–æ –≤–Ω—É—Ç—Ä–∏?"
        ),
        "options": ["—à–∏—Ñ—Ä", "–∫–ª—é—á", "—Å–µ–π—Ñ", "–±–ª–æ–∫"],
        "answer": "–∫–ª—é—á",
        "why": "–ï—Å–ª–∏ –∫–∞–∂–¥—É—é –±—É–∫–≤—É ¬´–º–Ω–∞—ç¬ª —Å–¥–≤–∏–Ω—É—Ç—å –Ω–∞ –¥–≤–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞–∑–∞–¥, –ø–æ–ª—É—á–∏—Ç—Å—è —Å–ª–æ–≤–æ ¬´–∫–ª—é—á¬ª.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç —à–∏—Ñ—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è —Å–≤–∏–¥–∞–Ω–∏—è —Å–¥–≤–∏–≥–æ–º +1: –∫–∞–∂–¥—É—é –±—É–∫–≤—É —Å–¥–≤–∏–≥–∞—é—Ç "
            "–Ω–∞ –æ–¥–Ω—É –ø–æ–∑–∏—Ü–∏—é –≤–ø–µ—Ä—ë–¥ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. –≠—Ç–æ —Ç–æ–∂–µ —à–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è. "
            "–ë—Ä–æ–¥—è–≥–∞ –¥–æ–ª–∂–µ–Ω –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å."
        ),
        "vraag": (
            "–û–Ω –≤–∑—è–ª —Å–ª–æ–≤–æ ¬´—Ö—ç—à¬ª –∏ –ø—Ä–∏–º–µ–Ω–∏–ª —Å–¥–≤–∏–≥ +1.\n"
            "–ö–∞–∫–æ–π –Ω–∞–±–æ—Ä –±—É–∫–≤ –ø–æ–ª—É—á–∏—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ?"
        ),
        "options": ["—Ü—ç–∏", "—à—ç—Ü", "—Ä—É–∏", "—Ç—ç–≥"],
        "answer": "—Ü—ç–∏",
        "why": "–ü—Ä–∏ —Å–¥–≤–∏–≥–µ +1 –∫–∞–∂–¥–∞—è –±—É–∫–≤–∞ ¬´—Ö—ç—à¬ª —É–µ–∑–∂–∞–µ—Ç –≤–ø–µ—Ä—ë–¥ –Ω–∞ –æ–¥–∏–Ω —à–∞–≥, –æ–±—Ä–∞–∑—É—è ¬´—Ü—ç–∏¬ª.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ø—Ä—è—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç –∫ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –≤—Å—Ç—Ä–µ—á–µ –≤ –≤–∏–¥–µ ¬´–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–º–∫–æ–≤¬ª. "
            "–ù–æ –±–µ–∑ –æ–¥–Ω–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —ç—Ç–∏ –∑–∞–º–∫–∏ –Ω–µ –æ—Ç–∫—Ä—ã—Ç—å ‚Äî –ë—Ä–æ–¥—è–≥–µ –Ω—É–∂–Ω–æ –≤—Å–ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ."
        ),
        "vraag": (
            "–ß—Ç–æ –Ω—É–∂–Ω–æ –∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –¥–≤–µ—Ä–Ω–æ–≥–æ –∑–∞–º–∫–∞, –∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º?"
        ),
        "options": ["–∑–∞–º–æ–∫", "—à–∏—Ñ—Ä", "–∫–ª—é—á", "—Ö—ç—à"],
        "answer": "–∫–ª—é—á",
        "why": "–ò –∑–∞–º–æ–∫, –∏ —à–∏—Ñ—Ä –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–∞ ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∏–ª–∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö –Ω–∞ –≤–µ—á–µ—Ä: "
            "–æ–Ω —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã –Ω–∏–∫—Ç–æ –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –Ω–µ —Å–º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏–º–µ–Ω–∞. "
            "–ë—Ä–æ–¥—è–≥–µ –Ω—É–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ—Ä–º–∏–Ω."
        ),
        "vraag": (
            "–ö–∞–∫ –ª—É—á—à–µ –≤—Å–µ–≥–æ –Ω–∞–∑–≤–∞—Ç—å —Å–ø–æ—Å–æ–± –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Ç–∞–∫, "
            "—á—Ç–æ–±—ã –æ–Ω —Å—Ç–∞–ª –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º –±–µ–∑ –∫–ª—é—á–∞?"
        ),
        "options": ["–±—É–∫–≤–∞", "–ø–∞—Ä–æ–ª—å", "—Ç–∞–±–ª–∏—Ü–∞", "—à–∏—Ñ—Ä"],
        "answer": "—à–∏—Ñ—Ä",
        "why": "–®–∏—Ñ—Ä ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —á—Ç–æ–±—ã –µ—ë –Ω–µ–ª—å–∑—è –±—ã–ª–æ –ø–æ–Ω—è—Ç—å –±–µ–∑ –∫–ª—é—á–∞.",
    },
    {
        "explain": (
            "–î–ª—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –≤–∞–ª–µ–Ω—Ç–∏–Ω–æ–∫ –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç —Ö—Ä–∞–Ω–∏—Ç ¬´—Å–ª–µ–¥—ã¬ª –±–∏–ª–µ—Ç–æ–≤ –≤ –≤–∏–¥–µ —Ö—ç—à–µ–π. "
            "–û–Ω —Å–ª–æ–∂–∏–ª –∏—Ö –≤ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚Äî –ë—Ä–æ–¥—è–≥–µ –Ω—É–∂–Ω–æ —É–≥–∞–¥–∞—Ç—å –∫–∞–∫—É—é."
        ),
        "vraag": "–ß—Ç–æ –∑–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–∞—â–µ –≤—Å–µ–≥–æ —Ö—Ä–∞–Ω–∏—Ç —Ç–∞–∫–∏–µ —Ö—ç—à–∏?",
        "options": ["–∫–æ–º–ø—å—é—Ç–µ—Ä", "—Ç–∞–±–ª–∏—Ü–∞", "–∞–ª–≥–æ—Ä–∏—Ç–º", "—Ä–µ–≥–∏—Å—Ç—Ä"],
        "answer": "—Ç–∞–±–ª–∏—Ü–∞",
        "why": "–¢–∞–±–ª–∏—Ü–∞ ‚Äî —É–¥–æ–±–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö—ç—à–µ–π –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ –±–∞–∑–µ.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É –º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞—Ç. "
            "–û–Ω –Ω–µ –∫–ª–∞–¥—ë—Ç —Ç–µ–∫—Å—Ç –≤ –∫–æ–Ω–≤–µ—Ä—Ç, –∞ —Å–∫—Ä—ã–≤–∞–µ—Ç –µ–≥–æ —Ü–∏—Ñ—Ä–æ–≤—ã–º —Å–ø–æ—Å–æ–±–æ–º. "
            "–ë—Ä–æ–¥—è–≥–∞ –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ."
        ),
        "vraag": "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –µ–º—É —Å–∫—Ä—ã—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–∏—Å—å–º–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –±—É–º–∞–≥—É?",
        "options": ["–∑–∞–º–æ–∫", "–ø–∞—Ä–æ–ª—å", "—à–∏—Ñ—Ä", "–∫–æ–Ω–≤–µ—Ä—Ç"],
        "answer": "—à–∏—Ñ—Ä",
        "why": "–®–∏—Ñ—Ä –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π –Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏, "
            "—á—Ç–æ–±—ã –≤—Å–µ –∑–Ω–∞–ª–∏: –ø–∏—Å—å–º–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ –∏ –µ–≥–æ –Ω–µ –ø–æ–¥–º–µ–Ω–∏–ª–∏. "
            "–ë—Ä–æ–¥—è–≥–µ –Ω—É–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å."
        ),
        "vraag": (
            "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –ø–∏—Å—å–º–∞, "
            "—Ö–æ—Ç—è —ç—Ç–æ –Ω–µ –ø–∞—Å–ø–æ—Ä—Ç?"
        ),
        "options": ["–ø–æ–¥–ø–∏—Å—å", "–±–ª–æ–∫—á–µ–π–Ω", "–∫–ª—é—á", "–±—É–º–∞–≥–∞"],
        "answer": "–ø–æ–¥–ø–∏—Å—å",
        "why": "–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å —Å–ª—É–∂–∏—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ ¬´–ª—é–±–æ–≤–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞¬ª –∫–∞–∫ –Ω–∞–±–æ—Ä –Ω—É–ª–µ–π –∏ –µ–¥–∏–Ω–∏—Ü ‚Äî "
            "—Ç–∞–∫ –ø—Ä–æ—â–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏ –±—ã—Å—Ç—Ä–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. "
            "–ë—Ä–æ–¥—è–≥–µ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è."
        ),
        "vraag": "–ß—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –≤ –≤–∏–¥–µ –Ω—É–ª–µ–π –∏ –µ–¥–∏–Ω–∏—Ü?",
        "options": ["–∞–ª–≥–æ—Ä–∏—Ç–º", "—à–∏—Ñ—Ä", "—Ö—ç—à", "—Ç–∞–±–ª–∏—Ü–∞"],
        "answer": "—Ö—ç—à",
        "why": "–•—ç—à ‚Äî —ç—Ç–æ –±–∏–Ω–∞—Ä–Ω–æ–µ (—Ü–∏—Ñ—Ä–æ–≤–æ–µ) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞–±–æ—Ä –Ω—É–ª–µ–π –∏ –µ–¥–∏–Ω–∏—Ü.",
    },
    {
        "explain": (
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –≥–æ–≤–æ—Ä–∏—Ç –ë—Ä–æ–¥—è–≥–µ: ¬´–•–æ—á–µ—à—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É ‚Äî "
            "–Ω–µ –∑–∞–±—É–¥—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ª—é–±–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è¬ª. "
            "–ß—Ç–æ —ç—Ç–æ?"
        ),
        "vraag": "–ß—Ç–æ —ç—Ç–æ –∑–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç?",
        "options": ["–ø–∏—Å—å–º–æ", "–∫–æ–¥", "—Å–µ–π—Ñ", "–∫–ª—é—á"],
        "answer": "–∫–ª—é—á",
        "why": "–í–æ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ö–µ–º–∞—Ö —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω –∫–ª—é—á ‚Äî –±–µ–∑ –Ω–µ–≥–æ —à–∏—Ñ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.",
    },
    {
        "explain": (
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç–∞: —Å–µ–∫—Ä–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –∏ –≤–≤–æ–¥–∏—Ç—å –ø—Ä–∏ –≤—Ö–æ–¥–µ. "
            "–ë–µ–∑ –Ω–µ–≥–æ –ø—É—Ç—å –∫ —Ñ–∏–Ω–∞–ª—É –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è."
        ),
        "vraag": "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–∞–∫–æ–π —Å–µ–∫—Ä–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –∏ –≤–≤–æ–¥–∏—Ç—å –ø—Ä–∏ –≤—Ö–æ–¥–µ?",
        "options": ["–∞–ª–≥–æ—Ä–∏—Ç–º", "–ø–∞—Ä–æ–ª—å", "–±—É–º–∞–≥–∞", "–±–ª–æ–∫–Ω–æ—Ç"],
        "answer": "–ø–∞—Ä–æ–ª—å",
        "why": "–ü–∞—Ä–æ–ª—å ‚Äî —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω–∞—è —Ñ—Ä–∞–∑–∞ –∏–ª–∏ –Ω–∞–±–æ—Ä —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∏—Å—Ç–µ–º–µ –∏–ª–∏ –ø–æ–¥–∞—Ä–∫–∞–º.",
    },
    {
        "explain": (
            "–ß—Ç–æ–±—ã ¬´–ª—é–±–æ–≤–Ω–∞—è –ø–æ—á—Ç–∞¬ª —Ä–∞–±–æ—Ç–∞–ª–∞ –±–µ–∑ –ø—É—Ç–∞–Ω–∏—Ü—ã, "
            "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–±–æ—Ä —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª. "
            "–ë—Ä–æ–¥—è–≥–µ –Ω—É–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å —ç—Ç–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º."
        ),
        "vraag": "–ß—Ç–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–∞–∫–æ–π –Ω–∞–±–æ—Ä —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª?",
        "options": ["–Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª", "–ø–∏—Å—å–º–æ", "–±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö", "–ø–æ–¥–ø–∏—Å—å"],
        "answer": "–Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª",
        "why": "–ü—Ä–æ—Ç–æ–∫–æ–ª ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–∑ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –¥–ª—è –æ–±–º–µ–Ω–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö.",
    },
]

# –ö–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –∏–≥—Ä—ã 1 (–ø—Ä–æ–≤–µ—Ä–∏—à—å –∏–º–µ–Ω–∞ –≤ static/)
# image_empty ‚Äî –Ω–∞ —ç–∫—Ä–∞–Ω–∞—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ë—Ä–æ–¥—è–≥–∞/–∫–≤–µ—Å—Ç)
# image_full  ‚Äî —Ñ–∏–Ω–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å—Ç—Ä–µ—á–∞/–ø–æ—Ü–µ–ª—É–π)
PUZZLE_IMAGE = "tree_empty.png"
PUZZLE_IMAGE_FULL = "tree_full.png"

# =========================================================
# –ò–≥—Ä–∞ 2: "–†–∞—Å—à–∏—Ñ—Ä—É–π –∑–∞–ø–∏—Å–∫—É" (—Ä–µ–∂–∏–º words), —Å–¥–≤–∏–≥ ‚àí3
# –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –æ—Å—Ç–∞–≤–∏–ª –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ ‚Äî –æ–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –ë—Ä–æ–¥—è–≥–µ –Ω–µ —Å–≤–µ—Ä–Ω—É—Ç—å —Å –ø—É—Ç–∏ üíå
# =========================================================

LETTER_EXAMPLE_EXPLAIN = (
    "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ª—é–±–∏—Ç –∑–∞–≥–∞–¥–∫–∏ –∏ —à–∏—Ñ—Ä—ã. "
    "–®–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –∫–∞–∂–¥—É—é –±—É–∫–≤—É —Å–¥–≤–∏–≥–∞—é—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–π –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É. "
    "–ß—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ, –Ω—É–∂–Ω–æ —Å–¥–≤–∏–Ω—É—Ç—å –∫–∞–∂–¥—É—é –±—É–∫–≤—É –ù–ê–ó–ê–î –Ω–∞ 3."
)

LETTER_PLAIN = (
    "–ò–Ω–æ–≥–¥–∞ –æ–¥–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –≤—Å—Ç—Ä–µ—á–∞ –ø–æ–¥ –∑–≤–µ–∑–¥–∞–º–∏ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –Ω–∞—á–∞–ª–æ–º —Å–∞–º–æ–π –Ω–µ–∂–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏"
)

LETTER_CIPHER = (
    "–õ–†–°–Å–ñ–ì –°–ñ–†–ì –§–û–¶–™–ì–ú–†–ì–í –ï–§–•–£–ó–™–ì –¢–°–ñ –ö–ï–ò–ö–ñ–ì–ü–õ –ü–°–ô–ó–• –§–•–ì–•–Ø –†–ì–™–ì–û–°–ü –§–ì–ü–°–ú –†–ó–ô–†–° –õ–§–•–°–£–õ–õ"
)

# =========================================================
# –ë–∞–∑–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
# =========================================================

@app.route("/")
def index():
    return render_template("index.html")


@app.route("/start", methods=["GET", "POST"])
def start():
    if request.method == "POST":
        nick = request.form.get("nick", "").strip()
        if not nick:
            flash("–í–ø–∏—à–∏ –∏–º—è –∏–ª–∏ –Ω–∏–∫ ‚Äî –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –∂–¥—ë—Ç —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫–≤–µ—Å—Ç–∞ üíò", "danger")
            return redirect(url_for("start"))

        session.clear()
        session["nick"] = nick
        session["mode"] = None

        flash("–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –∏—Å–ø—ã—Ç–∞–Ω–∏—è. –ü–æ–º–æ–∂–µ—à—å –ë—Ä–æ–¥—è–≥–µ –¥–æ–π—Ç–∏ –¥–æ –≤—Å—Ç—Ä–µ—á–∏? üêæüíò", "info")
        return redirect(url_for("game"))

    return render_template("start.html")


@app.route("/game")
def game():
    if "nick" not in session:
        return redirect(url_for("start"))

    if session.get("mode") is None:
        return render_template("game_menu.html", nick=session["nick"])

    mode = session["mode"]

    if mode == "quiz":
        return render_quiz()

    if mode == "words":
        return render_letter_game()

    session["mode"] = None
    return redirect(url_for("game"))


@app.route("/choose_mode/<mode>")
def choose_mode(mode):
    if "nick" not in session:
        return redirect(url_for("start"))

    if mode == "quiz":
        session["mode"] = "quiz"
        tasks = QUIZ_TASKS.copy()
        random.shuffle(tasks)
        session["quiz_tasks"] = tasks
        session["current"] = 0
        session["score"] = 0
        flash("–ò—Å–ø—ã—Ç–∞–Ω–∏—è –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç–∞ –Ω–∞—á–∞–ª–∏—Å—å! –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –ø–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ üê±üîê", "success")

    elif mode == "words":
        session["mode"] = "words"
        session["letter_step"] = 0
        flash("–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –æ—Å—Ç–∞–≤–∏–ª —à–∏—Ñ—Ä. –†–∞—Å—à–∏—Ñ—Ä—É–µ–º –∑–∞–ø–∏—Å–∫—É –∏ –ø–æ–ª—É—á–∏–º –ø–æ–¥—Å–∫–∞–∑–∫—É üíå", "success")

    else:
        flash("–¢–∞–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –Ω–µ—Ç. –í—ã–±–µ—Ä–∏ –æ–¥–Ω–æ –∏–∑ –∏—Å–ø—ã—Ç–∞–Ω–∏–π –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç–∞ üêæ", "danger")
        session["mode"] = None

    return redirect(url_for("game"))

# =========================================================
# –ò–≥—Ä–∞ 1: –ª–æ–≥–∏–∫–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
# =========================================================

def render_quiz():
    if "quiz_tasks" not in session:
        flash("–°–µ—Å—Å–∏—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å. –í—ã–±–µ—Ä–∏ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ –∑–∞–Ω–æ–≤–æ üê±üíò", "warning")
        session["mode"] = None
        return redirect(url_for("game"))

    current = session.get("current", 0)
    tasks = session["quiz_tasks"]

    if current >= len(tasks):
        score = session.get("score", 0)
        total = len(tasks)
        full_tree = score >= 8

        if full_tree:
            flash(
                f"–ë—Ä–∞–≤–æ! {score} –∏–∑ {total} ‚Äî –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –≥–æ—Ä–¥–∏—Ç—Å—è —Ç–æ–±–æ–π üê±üîê "
                "–¢—ã –ø–æ–º–æ–≥(–ª–∞) –õ–µ–¥–∏ –∏ –ë—Ä–æ–¥—è–≥–µ –Ω–∞–π—Ç–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ üíû "
                "–ü–æ—Ä–∞ –∏–¥—Ç–∏ –∑–∞ —Å–ª–∞–¥–∫–∏–º –ø–æ–¥–∞—Ä–æ—á–∫–æ–º! üç´‚ú®",
                "success",
            )

        else:
            flash(
                f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {score} –∏–∑ {total}. "
                "–ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ø–æ–¥–º–∏–≥–Ω—É–ª: ¬´–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ ‚Äî –∏ –ø—É—Ç—å –æ—Ç–∫—Ä–æ–µ—Ç—Å—è!¬ª ‚ú®",
                "info",
            )

        return render_template(
            "quiz_game.html",
            nick=session["nick"],
            finished=True,
            score=score,
            total=total,
            full_tree=full_tree,
            image_full=PUZZLE_IMAGE_FULL,
            image_empty=PUZZLE_IMAGE,
        )

    task = tasks[current]
    progress = int((current / len(tasks)) * 100)

    return render_template(
        "quiz_game.html",
        nick=session["nick"],
        finished=False,
        task=task,
        task_num=current + 1,
        total_tasks=len(tasks),
        progress=progress,
        image_empty=PUZZLE_IMAGE,
    )


@app.route("/submit_quiz", methods=["POST"])
def submit_quiz():
    if "nick" not in session or session.get("mode") != "quiz":
        return redirect(url_for("start"))

    answer = request.form.get("answer", "").lower().strip()
    current = session.get("current", 0)
    tasks = session.get("quiz_tasks", [])

    if current >= len(tasks):
        return redirect(url_for("game"))

    task = tasks[current]
    correct = task["answer"].lower()

    if answer == correct:
        session["score"] = session.get("score", 0) + 1
        flash(f"–í–µ—Ä–Ω–æ! {task['why']} üê±üíò", "success")
    else:
        flash(
            f"–ü–æ—á—Ç–∏! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: ¬´{task['answer']}¬ª. {task['why']}",
            "danger",
        )

    session["current"] = current + 1
    return redirect(url_for("game"))

# =========================================================
# –ò–≥—Ä–∞ 2: –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –ø–∏—Å—å–º–∞ (—Å–¥–≤–∏–≥ ‚àí3)
# =========================================================

def render_letter_game():
    step = session.get("letter_step", 0)

    if step == 0:
        return render_template(
            "words_game.html",
            nick=session["nick"],
            step=0,
            example_explain=LETTER_EXAMPLE_EXPLAIN,
            cipher=None,
            finished=False,
        )
    elif step == 1:
        return render_template(
            "words_game.html",
            nick=session["nick"],
            step=1,
            example_explain=LETTER_EXAMPLE_EXPLAIN,
            cipher=LETTER_CIPHER,
            finished=False,
        )
    else:
        return render_template(
            "words_game.html",
            nick=session["nick"],
            step=2,
            example_explain=LETTER_EXAMPLE_EXPLAIN,
            cipher=LETTER_CIPHER,
            plain=LETTER_PLAIN,
            finished=True,
        )


@app.route("/submit_word", methods=["POST"])
def submit_word():
    if "nick" not in session or session.get("mode") != "words":
        return redirect(url_for("start"))

    step = session.get("letter_step", 0)

    if step == 0:
        session["letter_step"] = 1
        return redirect(url_for("game"))

    if step == 1:
        user_text = request.form.get("phrase", "")

        user_clean = " ".join(user_text.strip().split()).lower()
        correct_clean = " ".join(LETTER_PLAIN.strip().split()).lower()

        if not user_clean:
            flash("–í–ø–∏—à–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é —Ñ—Ä–∞–∑—É ‚Äî –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç üíå", "warning")
            return redirect(url_for("game"))

        if user_clean == correct_clean:
            flash("–ï—Å—Ç—å! –ü–æ—Å–ª–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –ë—Ä–æ–¥—è–≥–∏ –ø–æ–ª—É—á–µ–Ω–∞ üíò", "success")
            session["letter_step"] = 2
        else:
            flash(
                "–ü–æ—Ö–æ–∂–µ, —Ñ—Ä–∞–∑–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è. "
                "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ—Ç –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç–∞: –ø—Ä–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ –¥–≤–∏–≥–∞–µ–º—Å—è –Ω–∞ 3 –±—É–∫–≤—ã –ù–ê–ó–ê–î ‚ú®",
                "danger",
            )
        return redirect(url_for("game"))

    return redirect(url_for("game"))

# =========================================================
# –°–±—Ä–æ—Å
# =========================================================

@app.route("/reset")
def reset():
    session.clear()
    flash("–ù–∞—á–Ω—ë–º –∑–∞–Ω–æ–≤–æ: –ö—Ä–∏–ø—Ç–æ-–∫–æ—Ç –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª –∏—Å–ø—ã—Ç–∞–Ω–∏—è —Å–Ω–æ–≤–∞ üê±üíò", "info")
    return redirect(url_for("start"))


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)
